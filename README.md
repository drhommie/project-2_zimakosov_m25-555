# Примитивная база данных (CLI)

Мини‑проект учебной базы данных на Python с консольным интерфейсом. 
Поддерживает создание/удаление таблиц, хранение данных в JSON, и полный набор операций **CRUD** — `insert`, `select`, `update`, `delete`. 
В проекте настроены линтер **Ruff** и автотесты. Также добавлены декораторы для обработки ошибок, логирования времени и подтверждения опасных действий.

## Возможности
- Создание и удаление таблиц со схемой столбцов (`int`, `str`, `bool`).  
- Хранение данных в `data/<table>.json`.  
- CRUD-операции с простым SQL-подобным синтаксисом.  
- Красивый вывод с **PrettyTable**.  
- Централизованные **декораторы**:
  - `@handle_db_errors` — перехватывает и красиво выводит ошибки (например, при некорректных командах или типах данных);  
  - `@confirm_action` — запрашивает подтверждение перед удалением таблицы или записей;  
  - `@log_time` — замеряет и отображает время выполнения операций для отладки. 

---

## Установка

Требования: **Python 3.12+**, **Poetry 2.x**

### Вариант A — через Poetry
```bash
poetry install
```

### Вариант B — через Makefile
```bash
make install
```

---

## Запуск

### Вариант A — через Poetry
```bash
poetry run database
```

### Вариант B — через Makefile
```bash
make run
```

После запуска вы попадёте в CLI‑интерфейс с приглашением к вводу команд.

---

## Быстрый старт (полный сценарий)

Ниже пример последовательности, покрывающей весь цикл: создание таблицы → добавление → чтение → обновление → удаление → удаление таблицы.

```text
# Создаём таблицу со схемой: ID:int добавляется автоматически
create_table users name:str age:int is_active:bool

# Добавляем записи
insert into users values ("Sergei", 28, true)
insert into users values ("Anna", 31, false)

# Выбираем данные
select from users
select from users where age = 28 and is_active = true

# Обновляем данные
update users set age = 29 where name = "Sergei"

# Удаляем записи
delete from users where name = "Anna"

# Информация о таблице
info users

# Удаляем таблицу
drop_table users
```

> Примечания:
> - Строки — в кавычках (`"text"`). Булевы значения: `true/false`, `yes/no`, `1/0`.
> - Данные сохраняются автоматически после `insert/update/delete`.
> - Для схемы таблиц используются типы: `int`, `str`, `bool`.

---

## Демонстрация (asciinema)

Полный сценарий работы показан в демонстрации ниже (встроенная запись):

[![asciinema demo (full)](https://asciinema.org/a/J0eFNtMwE0SrwDfc7tbXvB3nK.svg)](https://asciinema.org/a/J0eFNtMwE0SrwDfc7tbXvB3nK)

---

### Дополнительно (по шагам)

- **Управление таблицами (создание / список / удаление):**  
  [![asciinema demo](https://asciinema.org/a/sETP3BZ7z3s51MklTQWhIKxll.svg)](https://asciinema.org/a/sETP3BZ7z3s51MklTQWhIKxll)

- **CRUD-операции (создание / чтение / обновление / удаление):**  
  [![asciinema demo](https://asciinema.org/a/9vrWjyQki3q9l3MMc8ZXMc7A0.svg)](https://asciinema.org/a/9vrWjyQki3q9l3MMc8ZXMc7A0)

- **Этап 4 – Декораторы и замыкания:**  
  [![asciinema demo (full)](https://asciinema.org/a/usWjkW7rcvGQMxjbfEWCqFkll.svg)](https://asciinema.org/a/usWjkW7rcvGQMxjbfEWCqFkll)

---

## Полезные команды разработчика

Запуск линтера Ruff:
```bash
make lint
# или
poetry run ruff check .
```

Запуск тестов (если предусмотрено в проекте):
```bash
make test
# или
poetry run pytest -q
```

---

## Структура проекта (сокращённо)

```
project-root/
├─ src/
│  └─ primitive_db/
│     ├─ __init__.py
│     ├─ constants.py       # Все константы проекта (пути, типы, токены, флаги)
│     ├─ core.py            # Основная бизнес-логика (CRUD и работа с таблицами)
│     ├─ decorators.py      # Декораторы: обработка ошибок, подтверждения, логирование времени
│     ├─ engine.py          # Парсинг команд и главный цикл взаимодействия с пользователем
│     ├─ main.py            # Точка входа (CLI-интерфейс)
│     ├─ parser.py          # Разбор команд where/set/values
│     └─ utils.py           # Работа с файлами (загрузка/сохранение данных и метаданных)
├─ Makefile                 # Команды установки, запуска и линтинга
├─ pyproject.toml           # Настройки Poetry, зависимости, entry point
├─ poetry.lock              # Зафиксированные версии библиотек
├─ .gitignore               # Исключения из репозитория
└─ README.md                # Документация проекта

```
---

## Технические детали

- **Схемы таблиц** описаны в meta-файле (например, `db_meta.json`), при создании таблицы к схеме всегда добавляется `ID:int` (автоинкремент).
- **Вывод таблиц** реализован с помощью библиотеки PrettyTable.
- **Кэширование select** может быть реализовано замыканием для повторных запросов.
- **Обработка ошибок** реализована через `@handle_db_errors`, который перехватывает исключения, выводит понятные сообщения и предотвращает аварийное завершение программы.  
- **Подтверждения действий** выполняются через `@confirm_action`: перед удалением таблицы или записей программа требует подтверждения от пользователя.  
- **Логирование времени** (`@log_time`) помогает анализировать производительность операций при разработке.
---