# Примитивная база данных

## 1. Подготовка

Создайте проект с использованием Poetry 2.x, настройте `src-layout`, линтер Ruff и CLI-команду `database`.

## 2. База данных

На этом этапе реализовано создание, удаление и просмотр таблиц.

### Команды:
 - create_table <имя_таблицы> <столбец1:тип> <столбец2:тип> ... — создать таблицу (ID:int добавляется автоматически)
 - list_tables — показать список всех таблиц
 - drop_table <имя_таблицы> — удалить таблицу
 - help — справка
 - exit — выход
 
**Пример:**

- Введите команду: 
```bash
create_table users name:str age:int is_active:bool
```
- Результат:
```
Таблица "users" успешно создана со столбцами: ID:int, name:str, age:int, is_active:bool
```

- Введите команду: 
 ```bash
create_table users name:str
 ```
- Результат:
 ```
 Ошибка: Таблица "users" уже существует.
 ```

- Введите команду: 
```bash
list_tables
```
- Результат:
 ```
 users
 ```

- Введите команду: 
```bash
drop_table users
```
- Результат:
```
Таблица "users" успешно удалена.
```
 
 - Введите команду: 
 ```bash
 drop_table products
 ```
 - Результат:
 ```
 Ошибка: Таблица "products" не существует.
  ```

### Демонстрация
 
 [![asciinema demo](https://asciinema.org/a/sETP3BZ7z3s51MklTQWhIKxll.svg)](https://asciinema.org/a/sETP3BZ7z3s51MklTQWhIKxll)
 
## 3. CRUD-операции

Теперь реализован полный набор операций с данными — **CRUD** (Create, Read, Update, Delete).

### Общие сведения

Каждая таблица хранится в файле `data/<имя_таблицы>.json`.
Для вывода используется библиотека **PrettyTable**.

---

### insert

Создаёт новую запись в таблице.

**Синтаксис:**
```bash
insert into <имя_таблицы> values (<значение1>, <значение2>, ...)
```

**Пример:**
```bash
insert into users values ("Sergei", 28, true)
```

**Результат:**
```
Запись с ID=1 успешно добавлена в таблицу "users".
```

---

### select

Отображает данные из таблицы.

**Синтаксис:**
```bash
select from <имя_таблицы>
select from <имя_таблицы> where <колонка> = <значение> [and <колонка> = <значение> ...]
```

**Пример:**
```bash
select from users where age = 28
```

**Результат:**
```
+----+--------+-----+-----------+
| ID |  name  | age | is_active |
+----+--------+-----+-----------+
| 1  | Sergei | 28  |    True   |
+----+--------+-----+-----------+
```

---

### update

Изменяет существующие записи.

**Синтаксис:**
```bash
update <имя_таблицы> set <колонка1> = <новое_значение1>[, <колонка2> = <новое_значение2>] where <колонка_условия> = <значение>
```

**Пример:**
```bash
update users set age = 29 where name = "Sergei"
```

**Результат:**
```
Запись(и) в таблице "users" успешно обновлена(ы).
```

---

### delete

Удаляет записи по условию.

**Синтаксис:**
```bash
delete from <имя_таблицы> where <колонка> = <значение>
```

**Пример:**
```bash
delete from users where ID = 1
```

**Результат:**
```
Запись(и) успешно удалена(ы) из таблицы "users".
```

---

### info

Отображает схему таблицы и количество записей.

**Синтаксис:**
```bash
info <имя_таблицы>
```

**Пример:**
```bash
info users
```

**Результат:**
```
Таблица: users
Столбцы: ID:int, name:str, age:int, is_active:bool
Количество записей: 0
```

---

### Примечания

- Строки обязательно в кавычках.
- Булевы значения: `true/false`, `yes/no`, `1/0`.
- Все изменения сохраняются автоматически после `insert`, `update` и `delete`.
- Для вывода таблиц используется `prettytable`.

---

Теперь CLI поддерживает весь цикл:
- `create_table`, `drop_table`, `list_tables`
- `insert`, `select`, `update`, `delete`, `info`

### Демонстрация
 
 [![asciinema demo](https://asciinema.org/a/9vrWjyQki3q9l3MMc8ZXMc7A0.svg)](https://asciinema.org/a/9vrWjyQki3q9l3MMc8ZXMc7A0)

# Этап 4. Декораторы и замыкания

На заключительном этапе проект был дополнен рядом улучшений качества кода и UX.

## Добавленные декораторы

| Декоратор | Назначение | Где применяется |
|------------|-------------|-----------------|
| `@handle_db_errors` | Централизованная обработка ошибок `KeyError`, `ValueError`, `FileNotFoundError` без дублирования `try...except`. | Все функции ядра (`create_table`, `drop_table`, `list_tables`, `insert`, `select`, `update`, `delete`) |
| `@confirm_action(action_name)` | Запрашивает подтверждение перед опасными действиями. Пример вывода:<br>`Вы уверены, что хотите выполнить "удаление таблицы"? [y/n]:` | `drop_table`, `delete` |
| `@log_time` | Замеряет время выполнения операций, использует `time.monotonic()`. Пример вывода:<br>`Функция insert выполнилась за 0.003 секунд.` | `insert`, `select` |

## Замыкание-кэшер

Добавлена функция `create_cacher()`, реализующая кэширование результатов `select`-запросов:  
повторные одинаковые запросы возвращаются мгновенно без повторного чтения файла.

## Рефакторинг

- Удалены дублирующиеся `try...except` из ядра.  
- Все декораторы применены к нужным функциям.  
- Исправлены стилистические замечания Ruff (`make lint` — ✅).  

## Пример работы

```text
>>> create table people name:str age:int
Таблица "people" успешно создана со столбцами: ID:int, name:str, age:int

>>> insert into people values ("Bob", 25)
Функция insert выполнилась за 0.001 секунд.
Запись с ID=1 успешно добавлена в таблицу "people".

>>> select from people
Функция select выполнилась за 0.000 секунд.
+----+------+-----+
| ID | name | age |
+----+------+-----+
|  1 | Bob  |  25 |
+----+------+-----+

>>> delete from people where name="Bob"
Вы уверены, что хотите выполнить "удаление записей"? [y/n]: n
Операция отменена пользователем.

>>> drop table people
Вы уверены, что хотите выполнить "удаление таблицы"? [y/n]: y
Таблица "people" успешно удалена.
```

### Демонстрация
 
 [![asciinema demo](https://asciinema.org/a/9vrWjyQki3q9l3MMc8ZXMc7A0.svg)](https://asciinema.org/a/9vrWjyQki3q9l3MMc8ZXMc7A0)